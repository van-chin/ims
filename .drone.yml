kind: pipeline
type: docker
name: build

clone:
  disable: true


volumes:
  - name: node_modules
    host:
      path: /data/drones/data/node_modules


steps:
  - name: fetch-code
    image: node
    commands:
      - git clone http://Van:0.1234@192.168.100.136:3000/ims/ims.chin.ink.git
      - echo 'git clone .....  completed'

  - name: build-code
    image: node
    depends_on: [fetch-code]
    volumes:
      - name: node_modules
        path: /drone/src/node_modules
    commands:
      - cd ims.chin.ink && ls
      - npm --version
      - npm config set registry https://registry.npmmirror.com
      - npm install
      - npm run build

  - name: build-image
    image: plugins/docker
    depends_on: [build-code]
    commands:
      - echo build image
